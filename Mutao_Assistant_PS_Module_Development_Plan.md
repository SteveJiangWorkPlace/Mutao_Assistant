# Mutao Assistant - PS写作模块分阶段开发计划

## 项目概述
本计划针对Mutao Assistant中的**PS写作模块**进行分阶段开发。PS写作模块是留学文书工具的核心功能之一，后续将独立开发PS修改、推荐信（RL）写作、简历（CV）写作等独立模块。

## 模块化架构设计
当前PS写作模块采用独立架构设计，为后续其他文书模块预留了扩展空间：

### 1. 技术架构预留
- **统一API框架**：FastAPI应用结构支持多模块扩展
- **服务层分离**：Gemini服务、选择服务独立封装，便于复用
- **数据模型隔离**：PS专用数据模型，不与其他模块耦合
- **配置管理**：环境变量统一管理，支持模块独立配置

### 2. 扩展接口预留
```
app/
├── api/
│   ├── ps_write/          # PS写作API端点（当前模块）
│   ├── ps_edit/          # PS修改API端点（预留）
│   ├── rl_write/         # 推荐信写作API端点（预留）
│   └── cv_write/         # 简历写作API端点（预留）
└── services/
    ├── gemini.py         # AI服务通用封装（可复用）
    └── selection.py      # 选择服务（PS专用，其他模块可类似实现）
```

### 3. 数据库设计预留
- 各模块独立数据表结构
- 用户会话隔离管理
- 历史记录按模块分类存储

## 分阶段开发计划（PS写作模块）

### 阶段1：基础环境搭建与项目初始化
**目标**：创建项目骨架，配置开发环境
**预计时间**：2-3天
**预计token用量**：8,000-12,000 tokens

**核心任务**：
1. 创建项目目录结构
2. 配置Python虚拟环境
3. 安装核心依赖（FastAPI、Gemini、Pydantic等）
4. 设置环境变量管理
5. 创建.gitignore和基础配置文件

**代码量估算**：
- 配置文件：3个文件，约200行代码
- 依赖管理：requirements.txt，约20行
- 环境配置：.env.example，约15行
- 部署配置：render.yaml，约20行

**Token分配**：
- 代码编写：6,000 tokens
- 配置调试：2,000 tokens
- 文档编写：2,000 tokens

### 阶段2：FastAPI核心框架搭建
**目标**：实现基础FastAPI应用结构和API端点
**预计时间**：2-3天
**预计token用量**：12,000-18,000 tokens

**核心任务**：
1. 创建FastAPI主应用 (app/main.py)
2. 配置CORS中间件和基础路由
3. 实现健康检查端点 (/api/health)
4. 创建PS写作API路由结构
5. 设置全局异常处理

**代码量估算**：
- 主应用文件：1个，约100行代码
- 路由结构：1个，约50行代码
- 中间件配置：约30行代码
- 异常处理：约40行代码

**Token分配**：
- 框架代码：8,000 tokens
- API设计：4,000 tokens
- 测试验证：3,000 tokens
- 错误处理：3,000 tokens

### 阶段3：Gemini AI服务集成
**目标**：集成Google Gemini API，实现AI服务封装
**预计时间**：3-4天
**预计token用量**：15,000-22,000 tokens

**核心任务**：
1. 实现Gemini服务类封装 (services/gemini.py)
2. 配置代理支持（本地开发）
3. 实现异步内容生成接口
4. 添加API错误处理和重试机制
5. 创建测试端点验证集成

**代码量估算**：
- Gemini服务类：约150行代码
- 代理配置：约50行代码
- 异步接口：约80行代码
- 错误处理：约60行代码

**Token分配**：
- 服务封装：10,000 tokens
- 异步编程：5,000 tokens
- 错误处理：4,000 tokens
- 集成测试：3,000 tokens

### 阶段4：数据模型与核心提示词设计
**目标**：设计Pydantic数据模型和核心提示词模板
**预计时间**：4-5天
**预计token用量**：20,000-30,000 tokens

**核心任务**：
1. 设计PS写作专用数据模型 (models/schemas.py)
2. 创建增强版调研提示词模板
3. 设计5段式个人陈述提示词模板
4. 实现提示词参数化模板引擎
5. 创建提示词测试和验证机制

**代码量估算**：
- 数据模型：约120行代码
- 调研提示词：约150行文本
- 个人陈述提示词：约80行文本
- 模板引擎：约100行代码

**Token分配**：
- 数据模型设计：6,000 tokens
- 提示词工程：12,000 tokens（文本内容较多）
- 模板引擎：8,000 tokens
- 测试优化：4,000 tokens

### 阶段5：调研分析功能实现
**目标**：实现细分领域识别和行业调研功能
**预计时间**：5-6天
**预计token用量**：25,000-35,000 tokens

**核心任务**：
1. 实现`/api/ps-write/generate-with-selection`端点
2. 开发调研结果解析器（文本转结构化数据）
3. 实现匹配度评分算法
4. 添加参考文献真实性验证
5. 创建调研结果缓存机制

**代码量估算**：
- API端点：约100行代码
- 解析器：约200行代码
- 评分算法：约80行代码
- 缓存机制：约100行代码

**Token分配**：
- API实现：8,000 tokens
- 文本解析：12,000 tokens（逻辑复杂）
- 算法设计：6,000 tokens
- 缓存优化：4,000 tokens
- 质量验证：5,000 tokens

### 阶段6：交互选择与会话管理
**目标**：实现用户选择机制和会话状态管理
**预计时间**：3-4天
**预计token用量**：12,000-18,000 tokens

**核心任务**：
1. 实现选择服务类 (services/selection.py)
2. 创建用户会话管理（内存缓存）
3. 实现选择验证逻辑
4. 添加会话过期清理机制
5. 设计会话安全防护

**代码量估算**：
- 选择服务：约150行代码
- 会话管理：约100行代码
- 验证逻辑：约80行代码
- 安全机制：约70行代码

**Token分配**：
- 服务层：7,000 tokens
- 状态管理：5,000 tokens
- 安全设计：3,000 tokens
- 测试验证：3,000 tokens

### 阶段7：个人陈述生成功能
**目标**：实现完整的5段式个人陈述生成
**预计时间**：6-7天
**预计token用量**：28,000-40,000 tokens

**核心任务**：
1. 实现`/api/ps-write/generate-ps`端点
2. 开发个人陈述文本解析器
3. 实现段落结构验证
4. 添加输出格式规范化
5. 创建质量评估机制

**代码量估算**：
- API端点：约120行代码
- 文本解析器：约180行代码
- 结构验证：约100行代码
- 格式化：约80行代码

**Token分配**：
- 生成端点：8,000 tokens
- 文本处理：14,000 tokens（复杂解析逻辑）
- 结构验证：6,000 tokens
- 质量保证：8,000 tokens
- 格式优化：4,000 tokens

### 阶段8：测试优化与部署准备
**目标**：完成全面测试和部署配置
**预计时间**：4-5天
**预计token用量**：10,000-15,000 tokens

**核心任务**：
1. 编写单元测试和集成测试
2. 进行端到端流程测试
3. 优化性能和错误处理
4. 配置Render部署文件
5. 创建部署文档和操作指南

**代码量估算**：
- 单元测试：约200行代码
- 集成测试：约150行代码
- 性能优化：约100行代码
- 部署配置：约50行代码

**Token分配**：
- 测试编写：6,000 tokens
- 性能调优：3,000 tokens
- 部署配置：2,000 tokens
- 文档完善：4,000 tokens

## Token用量汇总表

| 阶段 | 阶段名称 | 预计时间 | Token范围 | 累计Token |
|------|----------|----------|------------|------------|
| 1 | 环境搭建 | 2-3天 | 8,000-12,000 | 8,000-12,000 |
| 2 | API框架 | 2-3天 | 12,000-18,000 | 20,000-30,000 |
| 3 | Gemini集成 | 3-4天 | 15,000-22,000 | 35,000-52,000 |
| 4 | 数据模型 | 4-5天 | 20,000-30,000 | 55,000-82,000 |
| 5 | 调研分析 | 5-6天 | 25,000-35,000 | 80,000-117,000 |
| 6 | 交互选择 | 3-4天 | 12,000-18,000 | 92,000-135,000 |
| 7 | PS生成 | 6-7天 | 28,000-40,000 | 120,000-175,000 |
| 8 | 测试部署 | 4-5天 | 10,000-15,000 | **130,000-190,000** |

**总Token估算**：130,000 - 190,000 tokens

## 开发资源分配

### 人力资源需求
- **后端开发工程师**：1人（全程）
- **AI提示词工程师**：0.5人（阶段4、5、7）
- **测试工程师**：0.5人（阶段8）

### 开发环境需求
- **开发机**：Python 3.9+，8GB RAM
- **测试环境**：独立的测试服务器
- **部署环境**：Render平台

### 外部依赖
- **Google Gemini API**：生产环境调用权限
- **代理服务**：本地开发使用（如需要）
- **GitHub仓库**：代码版本管理

## 风险控制与质量保证

### 技术风险
1. **Gemini API稳定性**：添加重试机制和降级方案
2. **提示词效果波动**：建立提示词版本管理和A/B测试
3. **性能瓶颈**：实施缓存策略和异步处理

### 质量保证措施
1. **单元测试覆盖率**：目标80%以上
2. **集成测试**：完整的端到端流程测试
3. **性能测试**：模拟并发用户场景
4. **安全测试**：输入验证和会话安全

### 监控与日志
- 关键操作日志记录
- API响应时间监控
- 错误率统计和告警
- 用户使用行为分析

## 后续模块开发预留

### 架构预留点
1. **API路由结构**：预留`/api/ps-edit/`、`/api/rl-write/`、`/api/cv-write/`路由
2. **服务层扩展**：Gemini服务可复用于其他模块
3. **数据库设计**：各模块独立表结构，避免耦合

### 技术栈一致性
- 保持FastAPI作为统一后端框架
- 继续使用Google Gemini作为核心AI引擎
- 统一的数据验证和错误处理模式
- 一致的部署和监控策略

### 开发经验复用
- 提示词工程方法论
- 文本解析和格式化技术
- 用户交互和状态管理
- 测试和质量保证流程

## 开发里程碑

### 里程碑1：基础框架完成（阶段1-3）
- 完成日期：第7-10天
- 交付物：可运行的API框架和Gemini集成
- 验收标准：健康检查通过，Gemini API可调用

### 里程碑2：核心功能完成（阶段4-5）
- 完成日期：第16-21天
- 交付物：调研分析功能完整实现
- 验收标准：可生成3个细分领域调研报告

### 里程碑3：交互功能完成（阶段6-7）
- 完成日期：第25-32天
- 交付物：完整的交互式PS写作流程
- 验收标准：用户可选择方向并生成个人陈述

### 里程碑4：生产就绪（阶段8）
- 完成日期：第29-37天
- 交付物：测试完成的生产环境部署
- 验收标准：通过所有测试，成功部署到Render

## 沟通与协作

### 开发团队沟通
- **每日站会**：同步进展和问题
- **代码评审**：每个阶段完成后进行
- **文档更新**：每个阶段更新技术文档

### 项目管理工具
- **任务跟踪**：GitHub Issues或Jira
- **代码管理**：GitHub仓库
- **文档管理**：Markdown文档集中管理

### 质量检查点
- 阶段结束时的代码评审
- 功能完成时的集成测试
- 部署前的性能和安全测试